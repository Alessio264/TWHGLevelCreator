<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dodgefield ‚Äì Level Editor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ===== MAIN MENU ===== -->
  <div id="home-screen">
    <div id="home-bg"></div>
    <div id="home-content">
      <div id="menu-logo-area">
        <div id="menu-logo-word">DODGEFIELD</div>
        <div id="menu-logo-sub">LEVEL EDITOR</div>
      </div>
      <div id="menu-buttons">
        <button id="home-btn-create" class="menu-btn menu-btn-create">
          <span class="menu-btn-icon">‚úè</span>
          <span class="menu-btn-label">CREATE</span>
          <span class="menu-btn-desc">Build &amp; play your own levels</span>
        </button>
        <button id="home-btn-online" class="menu-btn menu-btn-online">
          <span class="menu-btn-icon">üåê</span>
          <span class="menu-btn-label">ONLINE</span>
          <span class="menu-btn-desc">Play community levels</span>
        </button>
      </div>
      <div id="menu-footer">
        WASD / Arrow keys &nbsp;¬∑&nbsp; Collect coins &nbsp;¬∑&nbsp; Reach the green goal &nbsp;¬∑&nbsp; Don't touch the blue dots
      </div>
    </div>
  </div>

  <!-- ===== CREATE SCREEN (my levels list) ===== -->
  <div id="create-screen" class="hidden">
    <div id="home-bg"></div>
    <div id="home-content">
      <div id="home-header">
        <div id="home-logo">
          <button class="home-action-btn back-btn" id="create-btn-back">‚Üê Menu</button>
          <div id="home-logo-inner">
            <span class="home-logo-big">DODGEFIELD</span>
            <span class="home-logo-sub-tag">MY LEVELS</span>
          </div>
        </div>
        <div id="home-header-actions">
          <button class="home-action-btn" id="home-btn-import">&#11014; Import</button>
          <button class="home-action-btn" id="home-btn-save-all">&#11015; Export All</button>
        </div>
      </div>
      <div id="home-main">
        <div id="home-levels-panel">
          <div id="home-levels-header">
            <span id="home-levels-count">YOUR LEVELS</span>
          </div>
          <div id="home-levels-list"></div>
          <div id="home-empty" class="hidden">
            <div class="home-empty-icon">üéÆ</div>
            <div class="home-empty-text">No levels yet.<br>Hit the button below to make your first one!</div>
          </div>
          <button id="home-btn-new">+ NEW LEVEL</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== EDITOR ===== -->
  <div id="editor-screen" class="hidden">

    <header id="topbar">
      <div id="game-title">
        <button id="btn-home" title="Back to Home">‚åÇ</button>
        <button id="btn-sidebar-toggle" title="Toggle Sidebar (Tab)">‚ò∞</button>
        <span class="title-big">DODGEFIELD</span>
        <span class="title-small">EDITOR</span>
      </div>
      <div id="topbar-center">
        <input type="text" id="current-level-name-input" maxlength="40" placeholder="Level name‚Ä¶" />
      </div>
      <div id="topbar-actions">
        <button class="action-btn" id="btn-resize">‚äû Grid</button>
        <button class="action-btn" id="btn-undo">‚Ü© Undo</button>
        <button class="action-btn" id="btn-clear">‚úï Clear</button>
        <button class="action-btn primary" id="btn-play">‚ñ∂ Play</button>
        <button class="action-btn" id="btn-save">‚¨á Export</button>
      </div>
    </header>

    <div id="main-layout">
      <aside id="toolbar">
        <div id="toolbar-inner">

          <div class="toolbar-section">
            <p class="toolbar-section-label">TOOLS</p>
            <div class="tool-grid">
              <button class="tool-btn active" data-tool="wall">
                <span class="tool-swatch" style="background:#1a1a2e;"></span>
                <span class="tool-label">Wall</span><span class="tool-shortcut">1</span>
              </button>
              <button class="tool-btn" data-tool="erase">
                <span class="tool-swatch erase-swatch"></span>
                <span class="tool-label">Erase</span><span class="tool-shortcut">2</span>
              </button>
              <button class="tool-btn" data-tool="goal">
                <span class="tool-swatch" style="background:#28a845;"></span>
                <span class="tool-label">Goal</span><span class="tool-shortcut">3</span>
              </button>
              <button class="tool-btn" data-tool="player">
                <span class="tool-swatch" style="background:#e03030;"></span>
                <span class="tool-label">Spawn</span><span class="tool-shortcut">4</span>
              </button>
              <button class="tool-btn" data-tool="coin">
                <span class="tool-circle" style="background:#f0c020;"></span>
                <span class="tool-label">Coin</span><span class="tool-shortcut">5</span>
              </button>
              <button class="tool-btn" data-tool="enemy">
                <span class="tool-circle" style="background:#1a3acc;"></span>
                <span class="tool-label">Enemy</span><span class="tool-shortcut">6</span>
              </button>
              <button class="tool-btn" data-tool="key">
                <span class="tool-key-shape"></span>
                <span class="tool-label">Key</span><span class="tool-shortcut">7</span>
              </button>
              <button class="tool-btn" data-tool="door">
                <span class="tool-swatch" style="background:#e8c200;opacity:0.85;"></span>
                <span class="tool-label">Door</span><span class="tool-shortcut">8</span>
              </button>
              <button class="tool-btn" data-tool="ice">
                <span class="tool-swatch" style="background:#a0e0ff;border:2px solid #60b0e0;"></span>
                <span class="tool-label">Ice</span><span class="tool-shortcut">9</span>
              </button>
              <button class="tool-btn" data-tool="checkpoint">
                <span class="tool-swatch" style="background:#ff8c00;"></span>
                <span class="tool-label">Check</span><span class="tool-shortcut">K</span>
              </button>
              <button class="tool-btn" data-tool="select">
                <span class="tool-select-icon">‚ñ∂</span>
                <span class="tool-label">Select</span><span class="tool-shortcut">S</span>
              </button>
              <button class="tool-btn" data-tool="fill">
                <span class="tool-fill-icon">‚ó¢</span>
                <span class="tool-label">Fill</span><span class="tool-shortcut">F</span>
              </button>
            </div>
          </div>

          <div class="toolbar-divider"></div>

          <div id="context-panel">
            <div class="panel-block" id="panel-default">
              <p class="toolbar-section-label">TIPS</p>
              <p class="inst-text">üñ± Click &amp; drag to paint.</p>
              <p class="inst-text">üßä Ice locks your direction ‚Äî you slide until you exit.</p>
              <p class="inst-text">üèÅ Checkpoints save your position on touch.</p>
              <p class="inst-text">üîë Collect keys to open matching doors.</p>
              <p class="inst-text">‚ñ∂ Select to edit enemies, keys &amp; doors.</p>
              <p class="inst-text">Ctrl+Z undo ¬∑ Tab hides sidebar ¬∑ Esc cancels.</p>
            </div>

            <div class="panel-block hidden" id="panel-enemy">
              <p class="toolbar-section-label">ENEMY</p>
              <div class="tab-row">
                <button class="tab-btn active" id="tab-linear">Linear</button>
                <button class="tab-btn" id="tab-orbit">Orbit</button>
              </div>
              <div id="linear-settings">
                <button class="action-btn full-width" id="btn-set-path">üìç Set Path (A ‚Üí B)</button>
                <p id="path-hint" class="hint-text hidden"></p>
                <div id="path-readout" class="info-row hidden">
                  <span class="info-label">Path length</span>
                  <span id="path-readout-text" class="info-val"></span>
                </div>
                <label class="panel-label">Waypoints</label>
                <button class="action-btn full-width" id="btn-add-keyframe">+ Add Waypoint</button>
                <div id="keyframes-list"></div>
                <label class="panel-label">Travel time (seconds)</label>
                <div class="slider-number-row">
                  <input type="range" id="enemy-duration" min="0.25" max="255" step="0.25" value="3" class="panel-range" />
                  <input type="number" id="enemy-duration-num" min="0.25" max="255" step="0.25" value="3" class="num-input" />
                </div>
                <label class="panel-label">Start offset</label>
                <div class="slider-number-row">
                  <input type="range" id="enemy-phase" min="0" max="1" step="0.01" value="0" class="panel-range" />
                  <input type="number" id="enemy-phase-num" min="0" max="1" step="0.01" value="0" class="num-input" />
                </div>
                <label class="panel-label">Mode</label>
                <div class="btn-row">
                  <button class="choice-btn active" id="mode-bounce">Bounce</button>
                  <button class="choice-btn" id="mode-loop">Loop</button>
                </div>
                <label class="panel-label">Start direction</label>
                <div class="btn-row">
                  <button class="dir-btn active" id="dir-fwd">‚Üí Forward</button>
                  <button class="dir-btn" id="dir-bwd">‚Üê Backward</button>
                </div>
              </div>
              <div id="orbit-settings" class="hidden">
                <button class="action-btn full-width" id="btn-set-center">üéØ Set Center Point</button>
                <p id="center-hint" class="hint-text hidden"></p>
                <label class="panel-label">Radius (tiles, 0.25 snap)</label>
                <div class="slider-number-row">
                  <input type="range" id="orbit-radius" min="0.25" max="10" step="0.25" value="3" class="panel-range" />
                  <input type="number" id="orbit-radius-num" min="0.25" max="10" step="0.25" value="3" class="num-input" />
                </div>
                <label class="panel-label">Revolution time (seconds)</label>
                <div class="slider-number-row">
                  <input type="range" id="orbit-duration" min="0.25" max="255" step="0.25" value="4" class="panel-range" />
                  <input type="number" id="orbit-duration-num" min="0.25" max="255" step="0.25" value="4" class="num-input" />
                </div>
                <label class="panel-label">Start angle (¬∞)</label>
                <div class="slider-number-row">
                  <input type="range" id="orbit-angle" min="0" max="355" step="5" value="0" class="panel-range" />
                  <input type="number" id="orbit-angle-num" min="0" max="355" step="5" value="0" class="num-input" />
                </div>
                <label class="panel-label">Direction</label>
                <div class="btn-row">
                  <button class="choice-btn active" id="orbit-cw">‚Üª CW</button>
                  <button class="choice-btn" id="orbit-ccw">‚Ü∫ CCW</button>
                </div>
              </div>
              <button class="action-btn danger" id="btn-delete-enemy">üóë Delete Enemy</button>
            </div>

            <div class="panel-block hidden" id="panel-key">
              <p class="toolbar-section-label">KEY</p>
              <p class="inst-text">Collect to unlock all linked doors.</p>
              <label class="panel-label">Color</label>
              <div class="color-swatches" id="key-color-swatches">
                <button class="color-swatch active" data-color="#e8c200" style="background:#e8c200;"></button>
                <button class="color-swatch" data-color="#e03030" style="background:#e03030;"></button>
                <button class="color-swatch" data-color="#2244cc" style="background:#2244cc;"></button>
                <button class="color-swatch" data-color="#20aa40" style="background:#20aa40;"></button>
                <button class="color-swatch" data-color="#cc44cc" style="background:#cc44cc;"></button>
                <button class="color-swatch" data-color="#cc7700" style="background:#cc7700;"></button>
              </div>
              <label class="panel-label">Linked doors</label>
              <div id="key-doors-list" class="doors-list"></div>
              <button class="action-btn full-width" id="btn-link-door">üîó Link a Door</button>
              <p class="hint-text hidden" id="link-door-hint"></p>
              <button class="action-btn danger" id="btn-delete-key">üóë Delete Key</button>
            </div>

            <div class="panel-block hidden" id="panel-door">
              <p class="toolbar-section-label">DOOR</p>
              <p class="inst-text">Blocks passage until matching key is collected.</p>
              <div class="info-row" style="margin-top:6px;">
                <span class="info-label">Linked key</span>
                <span id="door-key-val" class="info-val">None</span>
              </div>
              <p class="inst-text" style="margin-top:4px;color:#888;">Select a key then click "Link a Door".</p>
              <button class="action-btn danger" id="btn-delete-door">üóë Remove Door</button>
            </div>
          </div>

          <div class="toolbar-divider"></div>

          <div id="level-settings-section">
            <p class="toolbar-section-label">LEVEL SETTINGS</p>
            <label class="panel-label">Time Limit</label>
            <div class="btn-row" style="margin-bottom:4px;">
              <button class="choice-btn active" id="timelimit-off">Off</button>
              <button class="choice-btn" id="timelimit-on">On</button>
            </div>
            <div id="timelimit-row" class="slider-number-row hidden">
              <input type="range" id="timelimit" min="5" max="600" step="5" value="60" class="panel-range" />
              <input type="number" id="timelimit-num" min="5" max="9999" step="1" value="60" class="num-input" />
            </div>
            <label class="panel-label">Player Speed</label>
            <div class="slider-number-row">
              <input type="range" id="speed" min="40" max="300" step="10" value="120" class="panel-range" />
              <input type="number" id="speed-num" min="40" max="9999" step="10" value="120" class="num-input" />
            </div>
          </div>

          <div class="toolbar-divider"></div>

          <div id="how-to-play">
            <p class="toolbar-section-label">HOW TO PLAY</p>
            <p class="inst-text">Collect all coins ‚Üí reach green goal.</p>
            <p class="inst-text">Blue dots = instant death.</p>
            <p class="inst-text">WASD / Arrow keys to move.</p>
            <p class="inst-text">R = reset attempt ¬∑ Esc = stop.</p>
          </div>

        </div>
      </aside>

      <main id="canvas-area">
        <canvas id="game-canvas"></canvas>
        <div id="hud" class="hidden">
          <span id="hud-deaths">Deaths: 0</span>
          <span id="hud-coins">Coins: 0/0</span>
          <span id="hud-keys" class="hidden">Keys: 0/0</span>
          <span id="hud-timer" class="hidden">0:00</span>
          <span id="hud-msg"></span>
        </div>
        <div id="win-overlay" class="hidden">
          <div id="win-box">
            <div id="win-title">üéâ LEVEL COMPLETE!</div>
            <div id="win-level-name"></div>
            <div id="win-stats">
              <div class="win-stat">
                <span class="win-stat-label">DEATHS</span>
                <span id="win-deaths">0</span>
              </div>
              <div class="win-stat">
                <span class="win-stat-label">TIME</span>
                <span id="win-time">0:00</span>
              </div>
            </div>
            <div id="win-actions">
              <button class="action-btn primary" id="btn-win-edit">‚Üê Edit</button>
              <button class="action-btn" id="btn-win-retry">‚Ü∫ Retry</button>
              <button class="action-btn" id="btn-win-home">‚åÇ Menu</button>
            </div>
          </div>
        </div>
        <div id="death-flash"></div>
      </main>
    </div>

    <footer id="statusbar">
      <span id="status-tool">Tool: Wall</span>
      <span id="status-grid">‚Äì</span>
      <span id="status-size"></span>
      <span id="status-msg"></span>
    </footer>

  </div>

  <!-- Generic Modal -->
  <div id="modal-overlay" class="hidden">
    <div id="modal-box">
      <h2 id="modal-title"></h2>
      <div id="modal-body"></div>
      <div id="modal-buttons">
        <button class="action-btn primary" id="modal-confirm">OK</button>
        <button class="action-btn" id="modal-cancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- ===== ONLINE SCREEN ===== -->
  <div id="online-screen" class="hidden">
    <div id="home-bg"></div>
    <div id="home-content">
      <div id="home-header">
        <div id="home-logo">
          <button class="home-action-btn back-btn" id="online-btn-back">‚Üê Menu</button>
          <div id="home-logo-inner">
            <span class="home-logo-big">DODGEFIELD</span>
            <span class="home-logo-sub-tag">ONLINE</span>
          </div>
        </div>
        <div id="home-header-actions">
          <button class="home-action-btn" id="online-btn-connect">üîó Connect</button>
          <button class="home-action-btn upload-btn-header" id="online-btn-upload">‚¨Ü Upload Level</button>
        </div>
      </div>
      <div id="home-main">
        <div id="home-levels-panel">
          <div id="home-levels-header">
            <span id="online-levels-count">COMMUNITY LEVELS</span>
          </div>
          <div id="online-levels-list"></div>
          <div id="online-empty" class="hidden">
            <div class="home-empty-icon">üåê</div>
            <div class="home-empty-text">
              No levels loaded yet.<br><br>
              <strong>‚¨Ü Upload Level</strong> ‚Äî share one of your levels<br>
              <strong>üîó Connect</strong> ‚Äî load levels by collection ID
            </div>
          </div>
          <div id="online-loading" class="hidden">
            <div class="home-empty-icon">‚è≥</div>
            <div class="home-empty-text">Loading levels‚Ä¶</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== UPLOAD WIZARD ===== -->
  <div id="upload-modal" class="hidden">
    <div id="upload-box">

      <!-- Step 1: instructions -->
      <div id="upload-step-1">
        <div class="upload-header">
          <span class="upload-step-tag">STEP 1 OF 3</span>
          EXPORT YOUR LEVEL FIRST
        </div>
        <div class="upload-body">
          <p class="upload-hint-top">Before uploading, you need to export your level as JSON from the editor. Here's how:</p>
          <div class="upload-how-row">
            <div class="upload-how-num">1</div>
            <div class="upload-how-text">Go back to <strong>Create</strong> and open the level you want to share.</div>
          </div>
          <div class="upload-how-row">
            <div class="upload-how-num">2</div>
            <div class="upload-how-text">Click the <strong>‚¨á Export</strong> button in the top-right of the editor.</div>
          </div>
          <div class="upload-how-row">
            <div class="upload-how-num">3</div>
            <div class="upload-how-text">In the popup, click <strong>Copy to Clipboard</strong>.</div>
          </div>
          <div class="upload-how-row">
            <div class="upload-how-num">4</div>
            <div class="upload-how-text">Come back here (Online ‚Üí Upload Level) and click <strong>Next</strong>.</div>
          </div>
        </div>
        <div class="upload-actions">
          <button class="action-btn" id="upload-btn-cancel-1">Cancel</button>
          <button class="action-btn primary" id="upload-step1-next">I copied it ‚Üí Next</button>
        </div>
      </div>

      <!-- Step 2: paste JSON -->
      <div id="upload-step-2" class="hidden">
        <div class="upload-header">
          <span class="upload-step-tag">STEP 2 OF 3</span>
          PASTE YOUR LEVEL
        </div>
        <div class="upload-body">
          <p class="upload-label">Paste the JSON you copied:</p>
          <textarea id="upload-textarea" spellcheck="false" placeholder='Paste here‚Ä¶ (it starts with { "id": ‚Ä¶ "name": ‚Ä¶ "grid": ‚Ä¶ })&#10;&#10;Tip: Ctrl+V to paste'></textarea>
          <div id="upload-preview" class="hidden">
            <div id="upload-preview-icon">‚úÖ</div>
            <div>
              <div id="upload-preview-name"></div>
              <div id="upload-preview-meta"></div>
            </div>
          </div>
          <div id="upload-error" class="hidden">‚ùå That doesn't look right. Make sure you copied the full text from the Export popup in the editor.</div>
        </div>
        <div class="upload-actions">
          <button class="action-btn" id="upload-step2-back">‚Üê Back</button>
          <button class="action-btn primary" id="upload-step2-next" disabled>Looks good ‚Üí Next</button>
        </div>
      </div>

      <!-- Step 3: author + collection -->
      <div id="upload-step-3" class="hidden">
        <div class="upload-header">
          <span class="upload-step-tag">STEP 3 OF 3</span>
          PUBLISH
        </div>
        <div class="upload-body">
          <label class="upload-label">Your name (shown on the level):</label>
          <input type="text" id="upload-author" placeholder="Anonymous" maxlength="30" />
          <label class="upload-label" style="margin-top:12px;">Collection ID <span style="font-weight:400;opacity:0.7;">(optional)</span>:</label>
          <p class="upload-hint">Already uploaded before? Paste your Collection ID here to add this level to your existing collection. Leave blank to create a new one.</p>
          <input type="text" id="upload-collection-id" placeholder="e.g. 1234567890abc‚Ä¶ (leave blank if new)" />
        </div>
        <div class="upload-actions">
          <button class="action-btn" id="upload-step3-back">‚Üê Back</button>
          <button class="action-btn primary" id="upload-btn-submit">üöÄ Publish!</button>
        </div>
      </div>

      <!-- Step 4: success -->
      <div id="upload-step-4" class="hidden">
        <div class="upload-header">üéâ LEVEL PUBLISHED!</div>
        <div class="upload-body">
          <p class="upload-label" style="margin-bottom:6px;">Your Collection ID:</p>
          <div id="upload-success-id"></div>
          <p class="upload-hint" style="margin-top:10px;">
            <strong>Save this ID!</strong> Share it with friends so they can load your levels via <em>Online ‚Üí Connect</em>.
            You'll also need it next time you want to add more levels to the same collection.
          </p>
        </div>
        <div class="upload-actions">
          <button class="action-btn primary" id="upload-btn-copy-id">üìã Copy ID</button>
          <button class="action-btn" id="upload-btn-done">Done</button>
        </div>
      </div>

    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>